var U=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var B=(o,t,l)=>t in o?U(o,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[t]=l,b=(o,t)=>{for(var l in t||(t={}))K.call(t,l)&&B(o,l,t[l]);if(M)for(var l of M(t))G.call(t,l)&&B(o,l,t[l]);return o},w=(o,t)=>Y(o,Z(t));import{R as E,j as n,r as m,a as d,C as J,e as F,E as z,b as H,F as _,P as f,h as S,o as Q,c as X,d as ee,O as te,p as oe,f as ne}from"./vendor.67fd1b6f.js";const le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&p(x)}).observe(document,{childList:!0,subtree:!0});function l(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function p(a){if(a.ep)return;a.ep=!0;const i=l(a);fetch(a.href,i)}};le();const se=o=>{const[t,l]=m.exports.useState("2"),[p,a]=m.exports.useState("1"),[i,x]=m.exports.useState("#f44336");return d("div",{className:"options",style:{top:o.rect.top,left:o.rect.left-290},children:[n("p",{children:"\u753B\u7B14\u7C97\u7EC6\uFF1A"}),n("input",{value:t,onChange:v=>l(v.target.value)}),n("p",{children:"\u900F\u660E\u5EA6\uFF1A"}),n("input",{value:p,onChange:v=>a(v.target.value)}),n("div",{children:n(J,{color:i,onChange:v=>x(v.hex)})}),d("div",{className:"flex items-center mt-20px",children:[n("button",{className:"flex-1 mr-10px",onClick:()=>{o.onConfirm({width:parseFloat(t)||2,alpha:parseFloat(p)||1,color:i})},children:"\u786E\u8BA4"}),n("button",{className:"flex-1",onClick:o.onCancel,children:"\u53D6\u6D88"})]})]})},ae=o=>{const t=o.target.getBoundingClientRect();return new Promise((l,p)=>{let a=document.createElement("div");a.style.position="fixed",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.top="0",a.style.zIndex="2",document.body.appendChild(a);const i=()=>{E.unmountComponentAtNode(a),document.body.removeChild(a),a=null};E.render(n(se,{rect:t,onCancel:()=>{i(),p()},onConfirm:x=>{i(),l(x)}}),a)})};const re=o=>{const[t,l]=m.exports.useState(o.info);return d("div",{className:"w-250px bg-white flex flex-col p-20px children:my-5px",children:[n("p",{children:"\u6807\u9898: "}),n("input",{value:(t==null?void 0:t.title)||"",onChange:p=>l(w(b({},t),{title:p.target.value}))}),n("p",{children:"\u5907\u6CE8: "}),n("input",{value:(t==null?void 0:t.remark)||"",onChange:p=>l(w(b({},t),{remark:p.target.value}))}),n("p",{children:"\u5176\u4ED6\u4FE1\u606F: "}),n("input",{value:(t==null?void 0:t.others)||"",onChange:p=>l(w(b({},t),{others:p.target.value}))}),d("div",{className:"flex items-center mt-20px",children:[n("button",{className:"flex-1 mr-10px",onClick:()=>{o.onConfirm(w(b({},t),{time:new Date().getTime()}))},children:"\u786E\u8BA4"}),n("button",{className:"flex-1",onClick:o.onCancel,children:"\u53D6\u6D88"})]})]})},ie=o=>new Promise(t=>{let l=document.createElement("div");l.style.position="fixed",l.style.left="0",l.style.right="0",l.style.bottom="0",l.style.top="0",l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",document.body.appendChild(l);const p=()=>{E.unmountComponentAtNode(l),document.body.removeChild(l),l=null};E.render(n(re,{info:o,onCancel:()=>{p(),t(!1)},onConfirm:a=>{p(),t(a)}}),l)}),ce=o=>{if(!o.manager)return null;const[t,l]=m.exports.useState(!0),[p,a]=m.exports.useState([]),[i,x]=m.exports.useState(!1),[v,k]=m.exports.useState([]),c=(e,h)=>{const T=S(e.info.time),C=S(h.info.time);return T.isAfter(C)?-1:1},N=()=>{const e=o.manager.getAllAnnotations().sort(c);a(e)},g=()=>{var T;const h=((T=o.manager)==null?void 0:T.findTool(f.CropTool.toolName)).images.sort(c);k([...h])};m.exports.useEffect(()=>(F.on(z,N),F.on(H,g),()=>{F.removeListener(z,N),F.removeListener(H,g)}),[]);const s=async(e,h)=>{var T;try{const C=await ae(e);(T=o.sk)==null||T.cursor(o.sk.ARROW),h===f.TextTool.toolName?o.manager.setToolEnabled(h,{fillColor:C.color,strokeAlpha:C.alpha,textSize:C.width}):o.manager.setToolEnabled(h,{strokeColor:C.color,strokeAlpha:C.alpha,strokeWeight:C.width})}catch{o.manager.quitTool()}},D=()=>{var e,h;o.sk&&((h=o.sk)==null||h.cursor((e=o.sk)==null?void 0:e.CROSS),o.manager.setToolEnabled(f.CropTool.toolName,{strokeColor:"blue"}))},I=async e=>{const h=await ie(e.info);h&&(e.info=h,N())},O=e=>{e.remove(),N()},A=e=>{const h=o.manager.findTool(f.CropTool.toolName),T=h.images.indexOf(e);h.images.splice(T,1),g()};return d(_,{children:[d("div",{className:"common-pannel pannel",children:[n("p",{onClick:e=>s(e,f.CircleTool.toolName),children:"\u5706\u5F62"}),n("p",{onClick:e=>s(e,f.SquareTool.toolName),children:"\u65B9\u5F62"}),n("p",{onClick:e=>s(e,f.TextTool.toolName),children:"\u6587\u5B57"}),n("p",{onClick:e=>s(e,f.LineTool.toolName),children:"\u76F4\u7EBF"}),n("p",{onClick:e=>s(e,f.ArrowLineTool.toolName),children:"\u7BAD\u5934"}),n("p",{onClick:e=>s(e,f.FreehandTool.toolName),children:"freehand"}),n("p",{onClick:e=>D(),children:"\u88C1\u526A"}),n("p",{onClick:e=>{t||x(!1),l(!t)},children:t?"\u9690\u85CF\u6807\u6CE8":"\u663E\u793A\u6807\u6CE8"}),n("p",{onClick:e=>{i||l(!1),x(!i)},children:i?"\u9690\u85CF\u622A\u56FE":"\u663E\u793A\u622A\u56FE"})]}),t&&d("div",{className:"common-pannel annotations-layer",children:[n("div",{className:"title outer sticky top-0 bg-white",children:"\u6807\u6CE8\u4FE1\u606F"}),p.map(e=>e.belong===f.CropTool.toolName?null:d("div",{className:"items-center outer",children:[n("span",{className:"text-15px font-500",children:e.belong}),d("div",{className:"flex flex-col space-y-5px !py-5px flex-1 !mx-15px w-0",children:[d("span",{children:["\u6807\u9898: ",e.info.title]}),d("span",{children:["\u5907\u6CE8: ",e.info.remark]}),d("span",{children:["\u5176\u4ED6\u4FE1\u606F: ",e.info.others]}),d("span",{children:["\u65F6\u95F4: ",S(e.info.time).format("DD HH:mm:ss")]})]}),d("div",{className:"flex flex-col space-y-10px children:h-25px",children:[n("button",{onClick:()=>I(e),children:"\u7F16\u8F91"}),n("button",{onClick:()=>O(e),children:"\u5220\u9664"})]})]},`annotation-${e.info.time}`))]}),i&&d("div",{className:"common-pannel images-layer",children:[n("div",{className:"title outer sticky top-0 bg-white",children:"\u622A\u56FE"}),v.map((e,h)=>d("div",{className:"flex flex-col space-y-5px outer",children:[d("span",{className:"font-500 text-15px",children:["\u6807\u9898: ",e.info.title]}),d("span",{children:["\u65F6\u95F4: ",S(e.info.time).format("YYYY-MM-DD HH:mm")]}),d("div",{className:"flex items-center !mx-0 !py-0",children:[n("img",{className:"flex-1 w-0 mr-10px",src:e.url}),n("button",{onClick:()=>A(e),children:"\u5220\u9664"})]})]},`image-${e.info.time}`))]})]})};function ue(){const o=m.exports.useRef(null),[t,l]=m.exports.useState(),[p,a]=m.exports.useState(),[i,x]=m.exports.useState(),[v,k]=m.exports.useState(!0),[c,N]=m.exports.useState(),[g]=m.exports.useState(()=>{const r=new f.TextTool,u=new f.CircleTool,y=new f.SquareTool,V=new f.LineTool,j=new f.FreehandTool,R=new f.ArrowLineTool,P=new f.CropTool,L=new f;return r.getToolInfo=()=>Promise.resolve({time:new Date().getTime(),title:prompt("\u8BF7\u8F93\u5165")}),R.getToolInfo=()=>Promise.resolve({time:new Date().getTime(),title:prompt("\u8BF7\u8F93\u5165")}),P.startRect=()=>{x({visible:!1})},P.endRect=({startX:$,startY:W})=>{x({visible:!0,x:$,y:W})},L.useTool(r).useTool(u).useTool(y).useTool(V).useTool(j).useTool(R).useTool(P),L}),[s,D]=m.exports.useState(),I=m.exports.useRef(new Q.exports.TileSource({width:7026,height:9221,tileSize:256,tileOverlap:2,getTileUrl(r,u,y){return`//openseadragon.github.io//example-images/highsmith/highsmith_files/${r}/${u}_${y}.jpg`}})),O=r=>{const u=te({element:r,crossOriginPolicy:"Anonymous",showNavigationControl:!1,showNavigator:!0,navigatorAutoFade:!1,navigatorAutoResize:!1,navigatorHeight:100,navigatorWidth:200,navigatorPosition:"TOP_LEFT",gestureSettingsMouse:{dblClickToZoom:!1,clickToZoom:!1}});return u.addHandler("full-screen",y=>{k(!y.fullScreen)}),u.open(I.current),u},A=m.exports.useCallback(()=>{if(!c||!g||s)return;c.addHandler("open",T),g.hasEnabledToolCallback=u=>{u?c.setMouseNavEnabled(!1):c.setMouseNavEnabled(!0)};const r=document.createElement("div");r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.overflow="hidden",c.canvas.append(r),new X(u=>{D(u)},r)},[c,g]);m.exports.useEffect(()=>{!s||!p||(c.addHandler("update-viewport",C),s.preload=()=>{g.preload(s)},s.setup=()=>{const r=c.viewport.getContainerSize();s.createCanvas(r.x,r.y),g.setup(s)},s.draw=()=>{s.clear();const r=h(),u=e();g.draw(s,r/t,u.x,u.y)},s.touchStarted=r=>{r.target.nodeName==="CANVAS"&&!(c!=null&&c.isMouseNavEnabled())&&g.touchStarted(s)},s.touchMoved=()=>{g.touchMoved(s)},s.touchEnded=r=>{var u;r.target.nodeName==="CANVAS"&&!(c!=null&&c.isMouseNavEnabled())&&((u=g.enabledTool)==null?void 0:u.name)!==f.CropTool.toolName&&(g.touchEnded(s),g.quitTool())})},[s,p]),m.exports.useEffect(()=>{let r;return o.current&&(r=O(o.current),N(r)),()=>{r.destroy()}},[]),m.exports.useEffect(()=>{A()},[A]);const e=()=>{const u=(c==null?void 0:c.world.getItemAt(0)).imageToViewportCoordinates(0,0,!1);return c==null?void 0:c.viewport.pixelFromPoint(u)},h=()=>c.viewport.getZoom(!0),T=()=>{const r=e(),u=h();l(u),a(r)},C=()=>{s==null||s.redraw()},q=async()=>{x({visible:!1});const r=g.enabledTool,u=await oe(c==null?void 0:c.drawer.canvas);s==null||s.loadImage(URL.createObjectURL(u),y=>{r.doCrop(s,()=>Promise.resolve(s.image(y,0,0,s.width,s.height)))})};return d("div",{children:[n("div",{className:"h-100vh w-full z-1",ref:o}),v&&ee.exports.createPortal(d(_,{children:[n(ce,{manager:g,sk:s}),!!(i!=null&&i.visible)&&d("div",{className:"fixed flex items-center z-1",style:{top:i.y-35,left:i==null?void 0:i.x},children:[n("button",{className:"bg-white",onClick:q,children:"\u786E\u5B9A"}),n("button",{className:"bg-white ml-10px",onClick:()=>{s==null||s.cursor(s.ARROW),x({visible:!1}),g.enabledTool.endCrop(),g.quitTool()},children:"\u53D6\u6D88"})]})]}),document.body)]})}E.render(n(ne.StrictMode,{children:n(ue,{})}),document.getElementById("root"));
//# sourceMappingURL=index.c878540f.js.map
